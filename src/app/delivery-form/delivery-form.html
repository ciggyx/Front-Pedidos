<div class="topbar">
  <div class="topbar-content">
    <div class="left-section">
      <a class="btn btn-outline-light" routerLink="/home">üè† Home</a>
    </div>
    <div class="right-section">
      <div class="dropdown">
        <button
          class="btn btn-light dropdown-toggle user-avatar-btn"
          type="button"
          data-bs-toggle="dropdown"
          aria-expanded="false"
        >
          <img
            src="assets/images/12225773.png"
            alt="Usuario"
            class="user-avatar"
          />
        </button>
        <ul class="dropdown-menu dropdown-menu-end">
          <li><a class="dropdown-item" href="javascript:void(0)">Perfil</a></li>
          <li>
            <a class="dropdown-item" href="javascript:void(0)">Configuraci√≥n</a>
          </li>
          <li>
            <a class="dropdown-item" href="javascript:void(0)">Cerrar sesi√≥n</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>

<div class="container mt-4">
  <h2>Crear Nuevo Delivery</h2>

  @if (successMessage) {
  <div class="alert alert-success mt-3" role="alert">{{ successMessage }}</div>
  } @if (errorMessage) {
  <div class="alert alert-danger mt-3" role="alert">{{ errorMessage }}</div>
  }

  <form [formGroup]="deliveryForm" (ngSubmit)="onSubmit()" class="mt-4">
    <div class="mb-3">
      <label for="personId" class="form-label">ID de Persona</label>
      <input
        type="text"
        id="personId"
        formControlName="personId"
        class="form-control"
        [class.is-invalid]="f['personId'].invalid && f['personId'].touched"
      />
      @if (f['personId'].invalid && f['personId'].touched) {
      <div class="invalid-feedback">
        @if (f['personId'].errors?.['required']) {
        <div>El ID de Persona es requerido.</div>
        } @if (f['personId'].errors?.['minlength']) {
        <div>El ID de Persona debe tener al menos 5 caracteres.</div>
        } @if (f['personId'].errors?.['maxlength']) {
        <div>El ID de Persona no puede exceder los 20 caracteres.</div>
        }
      </div>
      }
    </div>

    <div formGroupName="location" class="mb-3 border p-3 rounded">
      <h4>Ubicaci√≥n</h4>
      <div class="mb-3">
        <label for="lat" class="form-label">Latitud</label>
        <input
          type="number"
          id="lat"
          formControlName="lat"
          class="form-control"
          [class.is-invalid]="latControl.invalid && latControl.touched"
        />
        @if (latControl.invalid && latControl.touched) {
        <div class="invalid-feedback">
          @if (latControl.errors?.['required']) {
          <div>La Latitud es requerida.</div>
          } @if (latControl.errors?.['min'] || latControl.errors?.['max']) {
          <div>La Latitud debe estar entre -90 y 90.</div>
          }
        </div>
        }
      </div>
      <div class="mb-3">
        <label for="lng" class="form-label">Longitud</label>
        <input
          type="number"
          id="lng"
          formControlName="lng"
          class="form-control"
          [class.is-invalid]="lngControl.invalid && lngControl.touched"
        />
        @if (lngControl.invalid && lngControl.touched) {
        <div class="invalid-feedback">
          @if (lngControl.errors?.['required']) {
          <div>La Longitud es requerida.</div>
          } @if (lngControl.errors?.['min'] || lngControl.errors?.['max']) {
          <div>La Longitud debe estar entre -180 y 180.</div>
          }
        </div>
        }
      </div>
    </div>

    <div class="mb-3">
      <label for="radius" class="form-label">Radio (km)</label>
      <input
        type="number"
        id="radius"
        formControlName="radius"
        class="form-control"
        [class.is-invalid]="f['radius'].invalid && f['radius'].touched"
      />
      @if (f['radius'].invalid && f['radius'].touched) {
      <div class="invalid-feedback">
        @if (f['radius'].errors?.['required']) {
        <div>El Radio es requerido.</div>
        } @if (f['radius'].errors?.['min'] || f['radius'].errors?.['max']) {
        <div>El Radio debe ser un n√∫mero entre 1 y 1000.</div>
        }
      </div>
      }
    </div>

    <button
      type="submit"
      class="btn btn-success me-2"
      [disabled]="deliveryForm.invalid || isSubmitting"
    >
      <span
        class="spinner-border spinner-border-sm"
        role="status"
        aria-hidden="true"
        [ngStyle]="{ 'display': isSubmitting ? 'inline-block' : 'none' }"
      ></span>
      Crear Entrega
    </button>
    <button type="button" class="btn btn-secondary" (click)="goBack()">
      Cancelar
    </button>
  </form>
</div>
